# Image de base
FROM debian:10.2

# Variables
ENV debuser="toto"
# Attention mettre au moins 8 caractÃ¨res
ENV debpasswd="toto2019"

#Configuration des locales
RUN apt-get update && apt-get install locales -y && rm -rf /var/lib/apt/lists/* \
    && localedef -i fr_FR -c -f UTF-8 -A /usr/share/locale/locale.alias fr_FR.UTF-8
ENV LANG fr_FR.utf8

WORKDIR /home/$debuser/

# Installation et configuration de Mate
RUN apt install mate-desktop-environment-core -y

# Installation et configuration de tigervnc
RUN apt install tigervnc-standalone-server -y && sleep 5
RUN yes $debpasswd | vncpasswd
RUN vncserver :1 -geometry 800x600 -localhost no

# Installation et configuration de novnc
RUN apt install openssl -y
RUN apt install novnc python-websockify -y
RUN echo 'exec /usr/bin/mate-session &' > /home/$debuser/.vnc/xstartup
CMD websockify -D --web=/usr/share/novnc/ 6080 localhost:5901 && sleep 200

EXPOSE 6080
EXPOSE 5901

VOLUME /home/$debuser/Partage
